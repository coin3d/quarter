##############################################################################
# CPACK Configuration for Linux Fedora 27
# See also http://fedoraproject.org/wiki/Packaging:Naming
# This configuration tested with rpmlint (https://github.com/rpm-software-management/rpmlint)

cmake_policy(SET CMP0012 NEW)

include("@CMAKE_CURRENT_BINARY_DIR@/CPackConfig-base.cmake")
package_basics(LOWCASE)

# see https://fedoraproject.org/wiki/Packaging:DistTag?rd=Packaging/DistTag
set(FEDORA_DIST_TAG ".fc27")

# this macro define a component package according to Fedora specifications for
# COMPONENT NAME, GROUP and FILE NAME POSTFIX (third optional argument)
macro(component COMPONENT GROUP)
  if (${ARGC} GREATER 2)
    set(CPACK_RPM_${COMPONENT}_PACKAGE_NAME "${CPACK_PACKAGE_NAME}-${ARGV2}")
  else()
    set(CPACK_RPM_${COMPONENT}_PACKAGE_NAME "${CPACK_PACKAGE_NAME}")
  endif()
  set(CPACK_RPM_${COMPONENT}_FILE_NAME "${CPACK_RPM_${COMPONENT}_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION}-1${FEDORA_DIST_TAG}.@CMAKE_HOST_SYSTEM_PROCESSOR@.rpm")
  set(CPACK_RPM_${COMPONENT}_PACKAGE_GROUP ${GROUP})
endmacro(component)

set(CPACK_GENERATOR             "RPM")
set(CPACK_PACKAGE_FILE_NAME     "${CPACK_PACKAGE_NAME}-${CPACK_PACKAGE_VERSION}-1${FEDORA_DIST_TAG}.@CMAKE_HOST_SYSTEM_PROCESSOR@.rpm")
set(CPACK_RPM_COMPONENT_INSTALL "ON")
set(CPACK_RPM_PACKAGE_LICENSE   "BSD")
set(CPACK_RPM_PACKAGE_URL       "@PROJECT_URL@")
set(CPACK_RPM_EXCLUDE_FROM_AUTO_FILELIST_ADDITION 
"/opt"
"/usr/lib64/cmake"
"/usr/lib64/qt5"
"/usr/lib64/qt5/plugins"
"/usr/lib64/qt5/plugins/designer"
)
set(CPACK_RPM_RUNTIME_POST_INSTALL_SCRIPT_FILE       "@CMAKE_CURRENT_SOURCE_DIR@/fedora_post_uninstall.sh")
set(CPACK_RPM_RUNTIME_POST_UNINSTALL_SCRIPT_FILE     "@CMAKE_CURRENT_SOURCE_DIR@/fedora_post_uninstall.sh")
set(CPACK_RPM_DEVELOPMENT_POST_INSTALL_SCRIPT_FILE   "@CMAKE_CURRENT_SOURCE_DIR@/fedora_post_uninstall.sh")
set(CPACK_RPM_DEVELOPMENT_POST_UNINSTALL_SCRIPT_FILE "@CMAKE_CURRENT_SOURCE_DIR@/fedora_post_uninstall.sh")

component(RUNTIME     "System Environment/Libraries" libs)
component(DEVELOPMENT "Development/Libraries"        devel)
component(EXAMPLES    "Documentation"                examples)
